- name: Setup VM
  hosts: proxmox-hosts
  tasks:
  - name: Clone VM from Template
    shell: qm clone $template_id $id --name $hostname --full true
  - name: Store cloud-init Network & User Data to Volume
    shell: >
      qm set $id --cicustom "user=local:cloud-init/user-data,network=local:cloud-init/network-$type"
  - name: Set VM Network Configuration
    shell: >
      for bridge in $bridges; do
        qm set $id --net0 "virtio,bridge=$$bridge,firewall=1"
      done
  - name: Set VM Resources
    shell: >
      qm set $id --cores $cores --memory $memory